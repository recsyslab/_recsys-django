# 人気ベース推薦システムによる推薦リストの取得



リスト1: `recsys_django/static/js/MainPage.js`
```js
    /**
     * 人気ベース推薦システムによる推薦リストを取得する。
     */
    getPopularityBasedRecommendations() {
        let thisPage = this;
        $.ajax({
            url: 'popularity/',
            method: 'GET',
            data: {
            },
            timeout: 10000,
            dataType: "json",
        }).done(function(response) {
            let description = response.description;
            let reclist = response.reclist;
            thisPage.slots[MAIN_SLOT_POPULARITY].isActive = true;
            thisPage.slots[MAIN_SLOT_POPULARITY].setRecList(description, reclist);
            thisPage.draw();
        }).fail(function(response) {
            window.alert('MainPage::getPopularityBasedRecommendations() : failed');
        });
    }
```

リスト2: `recsys_django/online/views.py`
```py
import json

from django.views.generic import View
from django.shortcuts import render
from django.http import HttpResponse

from online.models import Item, ReclistPopularity                   # ReclistPopularityを追加
from online.mappers import RecRandomMapper, RecPopularityMapper     # RecPopularityMapperを追加
...（略）...
class PopularityView(View):
    """人気ベース推薦ビュー
    """

    def get(self, request, *args, **kwargs):
        """人気ベース推薦リストを取得する。

        Parameters
        ----------
        request : WSGIRequest
            リクエスト

        Returns
        -------
        HttpResponse
            推薦説明と推薦リストをJSON形式で返す。
        """
        # オブジェクトの取得
        reclist = ReclistPopularity.objects.all()
        recs = [RecPopularityMapper(rec).as_dict() for rec in reclist]

        # レスポンスの生成
        description = '人気の寿司'
        response = {
            'description': description,
            'reclist': recs,
        }
        response_json = json.dumps(response)

        # レスポンスの返却
        return HttpResponse(response_json, content_type='application/json')
```

リスト3: `recsys_django/online/mappers.py`
```py
class RecPopularityMapper:
    """人気ベース推薦マッパー

    Attributes
    ----------
    rec : ReclistPopularity
        推薦オブジェクト
    """

    def __init__(self, rec):
        self.rec = rec

    def as_dict(self):
        """推薦オジェクトを辞書型として取得する。

        Returns
        -------
        dict
            推薦オブジェクトを辞書型にして返す。
        """
        item = self.rec.item
        return {
            'rank': self.rec.rank,
            'item': {
                'item_id': item.item_id,
                'name': item.name,
                'red': item.red,
                'white': item.white,
                'shining': item.shining,
            },
            'score': self.rec.score,
        }
```

リスト4: `recsys_django/static/js/main.js`
```js
/**
 * データの初期化
 */
function initData() {
    currentPage = mainPage;

    // 各推薦リストの取得
    mainPage.getRandomRecommendations();
    mainPage.getPopularityBasedRecommendations();       // 追加
    
    currentPage.draw();
}
```
